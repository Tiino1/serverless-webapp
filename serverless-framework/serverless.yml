service: nlpf

frameworkVersion: '2'

configValidationMode: error

provider:
  name: aws
  runtime: ruby2.7
  lambdaHashingVersion: 20201221
  timeout: 5
  region: ${file(env.yml):AMAZON_REGION}
  environment:
    AWS_ACCESS_KEY_ID: ${file(env.yml):AWS_ACCESS_KEY_ID}
    AWS_SECRET_ACCESS_KEY: ${file(env.yml):AWS_SECRET_ACCESS_KEY}
    AMAZON_REGION: ${file(env.yml):AMAZON_REGION}

functions:
  example_hello_world:
    handler: lambdas/examples/hello_world.hello_world     # function to call
    events:
      - http:
          path: hello     # endpoint
          method: post    # http verb

  example_post_request:
    handler: lambdas/examples/post_request.post_request
    events:
      - http:
          path: id/{id}   # url-named parameter id
          method: post
          request:
            parameters:
              paths:
                id: true  # required parameter
              querystrings:
                hat: true # required parameter

  mutation_create:
    role: dynamodbIAMRole   # aws role policy, declared in this file in resource.Resources.dynamodbIAMRole
    handler: lambdas/mutation_create.mutation_create
    events:
      - http:
          path: mutation
          method: post

resources:
  Resources:
    dynamodbIAMRole:
      Type: AWS::IAM::Role
      Properties:
        Path: /nlpf/
        RoleName: dynamodb_IAM_role
        AssumeRolePolicyDocument:
          Version: '2012-10-17'
          Statement:
            - Effect: Allow
              Principal:
                Service:
                  - lambda.amazonaws.com
              Action: sts:AssumeRole
        Policies:
          - PolicyName: myPolicyName
            PolicyDocument:
              Version: '2012-10-17'
              Statement:
                - Effect: Allow
                  Action:
                    - dynamodb:ListTables
                    - dynamodb:Scan
                  Resource: "*"
